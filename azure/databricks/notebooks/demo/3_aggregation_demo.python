{"version":"NotebookV1","origId":767643462327034,"name":"3_aggregation_demo","language":"python","commands":[{"version":"CommandV1","origId":767643462327035,"guid":"dba5231c-e160-4dd1-ad18-04e14f47e21a","subtype":"command","commandType":"auto","position":1.0,"command":"%run \"../includes/configuration\"","commandVersion":8,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673083983939,"submitTime":1673083983939,"finishTime":1673083984462,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"21e91569-3dda-4ad0-b140-12ef96e68ccc"},{"version":"CommandV1","origId":767643462327038,"guid":"d0977e1d-44d3-499a-9a61-2c417886314d","subtype":"command","commandType":"auto","position":2.0,"command":"\ndf = spark.read.parquet(f'{presentation_folder_path}/races_results')\ndf.show()","commandVersion":8,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+---------+--------------------+-------------------+----------------+----------------+-------------+------------------+--------+----+-----------+-----------+------+--------------------+\n|race_year|           race_name|          race_date|circuit_location|     driver_name|driver_number|driver_nationality|    team|grid|fastest_lap|  race_time|points|        created_dame|\n+---------+--------------------+-------------------+----------------+----------------+-------------+------------------+--------+----+-----------+-----------+------+--------------------+\n|     2014|Abu Dhabi Grand Prix|2014-11-23 13:00:00|       Abu Dhabi|  Lewis Hamilton|           44|           British|Mercedes|   2|         49|1:39:02.619|  50.0|2023-01-07 09:31:...|\n|     2014|Abu Dhabi Grand Prix|2014-11-23 13:00:00|       Abu Dhabi|    Felipe Massa|           19|         Brazilian|Williams|   4|         47|     +2.576|  36.0|2023-01-07 09:31:...|\n|     2014|Abu Dhabi Grand Prix|2014-11-23 13:00:00|       Abu Dhabi| Valtteri Bottas|           77|           Finnish|Williams|   3|         54|    +28.880|  30.0|2023-01-07 09:31:...|\n|     2020|Emilia Romagna Gr...|2020-11-01 12:10:00|           Imola|  Lewis Hamilton|           44|           British|Mercedes|   2|         63|1:28:32.430|  26.0|2023-01-07 09:31:...|\n|     2019|  British Grand Prix|2019-07-14 13:10:00|     Silverstone|  Lewis Hamilton|           44|           British|Mercedes|   2|         52|1:21:08.452|  26.0|2023-01-07 09:31:...|\n|     2019|  Spanish Grand Prix|2019-05-12 13:10:00|        Montmeló|  Lewis Hamilton|           44|           British|Mercedes|   2|         54|1:35:50.443|  26.0|2023-01-07 09:31:...|\n|     2019|  Russian Grand Prix|2019-09-29 11:10:00|           Sochi|  Lewis Hamilton|           44|           British|Mercedes|   2|         51|1:33:38.992|  26.0|2023-01-07 09:31:...|\n|     2019|   German Grand Prix|2019-07-28 13:10:00|      Hockenheim|  Max Verstappen|           33|             Dutch|Red Bull|   2|         61|1:44:31.275|  26.0|2023-01-07 09:31:...|\n|     2020|   Tuscan Grand Prix|2020-09-13 13:10:00|         Mugello|  Lewis Hamilton|           44|           British|Mercedes|   1|         58|2:19:35.060|  26.0|2023-01-07 09:31:...|\n|     2019|Abu Dhabi Grand Prix|2019-12-01 13:10:00|       Abu Dhabi|  Lewis Hamilton|           44|           British|Mercedes|   1|         53|1:34:05.715|  26.0|2023-01-07 09:31:...|\n|     2020|  Russian Grand Prix|2020-09-27 11:10:00|           Sochi| Valtteri Bottas|           77|           Finnish|Mercedes|   3|         51|1:34:00.364|  26.0|2023-01-07 09:31:...|\n|     2019|Australian Grand ...|2019-03-17 05:10:00|       Melbourne| Valtteri Bottas|           77|           Finnish|Mercedes|   2|         57|1:25:27.325|  26.0|2023-01-07 09:31:...|\n|     2020|Hungarian Grand Prix|2020-07-19 13:10:00|        Budapest|  Lewis Hamilton|           44|           British|Mercedes|   1|         70|1:36:12.473|  26.0|2023-01-07 09:31:...|\n|     2019| Austrian Grand Prix|2019-06-30 13:10:00|       Spielburg|  Max Verstappen|           33|             Dutch|Red Bull|   2|         60|1:22:01.822|  26.0|2023-01-07 09:31:...|\n|     2020|Portuguese Grand ...|2020-10-25 12:10:00|        Portimão|  Lewis Hamilton|           44|           British|Mercedes|   1|         63|1:29:56.828|  26.0|2023-01-07 09:31:...|\n|     2012|Singapore Grand Prix|2012-09-23 12:00:00|      Marina Bay|Sebastian Vettel|            5|            German|Red Bull|   3|         50|2:00:26.144|  25.0|2023-01-07 09:31:...|\n|     2011| Japanese Grand Prix|2011-10-09 06:00:00|          Suzuka|   Jenson Button|           22|           British| McLaren|   2|         52|1:30:53.427|  25.0|2023-01-07 09:31:...|\n|     2012|  Chinese Grand Prix|2012-04-15 07:00:00|        Shanghai|    Nico Rosberg|            6|            German|Mercedes|   1|         40|1:36:26.929|  25.0|2023-01-07 09:31:...|\n|     2011|Malaysian Grand Prix|2011-04-10 08:00:00|    Kuala Lumpur|Sebastian Vettel|            5|            German|Red Bull|   1|         33|1:37:39.832|  25.0|2023-01-07 09:31:...|\n|     2011|  British Grand Prix|2011-07-10 12:00:00|     Silverstone| Fernando Alonso|           14|           Spanish| Ferrari|   3|         41|1:28:41.196|  25.0|2023-01-07 09:31:...|\n+---------+--------------------+-------------------+----------------+----------------+-------------+------------------+--------+----+-----------+-----------+------+--------------------+\nonly showing top 20 rows\n\n","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"race_year","nullable":true,"type":"integer"},{"metadata":{},"name":"race_name","nullable":true,"type":"string"},{"metadata":{},"name":"race_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"circuit_location","nullable":true,"type":"string"},{"metadata":{},"name":"driver_name","nullable":true,"type":"string"},{"metadata":{},"name":"driver_number","nullable":true,"type":"integer"},{"metadata":{},"name":"driver_nationality","nullable":true,"type":"string"},{"metadata":{},"name":"team","nullable":true,"type":"string"},{"metadata":{},"name":"grid","nullable":true,"type":"integer"},{"metadata":{},"name":"fastest_lap","nullable":true,"type":"integer"},{"metadata":{},"name":"race_time","nullable":true,"type":"string"},{"metadata":{},"name":"points","nullable":true,"type":"float"},{"metadata":{},"name":"created_dame","nullable":true,"type":"timestamp"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673083985984,"submitTime":1673083985961,"finishTime":1673083986359,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",4490]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d6f515e1-feb4-4a5a-8293-1817ac1015e1"},{"version":"CommandV1","origId":767643462327040,"guid":"7b56eea5-9c77-4986-842e-8b3c11066ab4","subtype":"command","commandType":"auto","position":3.0,"command":"df_filtered = df.filter('race_year = 2020')\ndf_filtered.count()","commandVersion":31,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[11]: 340","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df_filtered","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"race_year","nullable":true,"type":"integer"},{"metadata":{},"name":"race_name","nullable":true,"type":"string"},{"metadata":{},"name":"race_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"circuit_location","nullable":true,"type":"string"},{"metadata":{},"name":"driver_name","nullable":true,"type":"string"},{"metadata":{},"name":"driver_number","nullable":true,"type":"integer"},{"metadata":{},"name":"driver_nationality","nullable":true,"type":"string"},{"metadata":{},"name":"team","nullable":true,"type":"string"},{"metadata":{},"name":"grid","nullable":true,"type":"integer"},{"metadata":{},"name":"fastest_lap","nullable":true,"type":"integer"},{"metadata":{},"name":"race_time","nullable":true,"type":"string"},{"metadata":{},"name":"points","nullable":true,"type":"float"},{"metadata":{},"name":"created_dame","nullable":true,"type":"timestamp"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673083988649,"submitTime":1673083988619,"finishTime":1673083988963,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",12]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"76d5f6c9-a1a9-4519-8220-2975de870085"},{"version":"CommandV1","origId":767643462327041,"guid":"f94552a0-7020-4cc0-bc72-f71eaf716933","subtype":"command","commandType":"auto","position":4.0,"command":"df_filtered.select(countDistinct('race_name')).show()","commandVersion":18,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+-------------------------+\n|count(DISTINCT race_name)|\n+-------------------------+\n|                       17|\n+-------------------------+\n\n","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673084249540,"submitTime":1673084249518,"finishTime":1673084250057,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",141]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b705f074-7ff0-4f57-87c5-29c70cd029b7"},{"version":"CommandV1","origId":767643462327044,"guid":"aa81c6bd-9936-4f88-89ad-7b6a8497d8f0","subtype":"script","commandType":"auto","position":1.5,"command":"","commandVersion":22,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673083984214,"submitTime":0,"finishTime":1673083984257,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["dba5231c-e160-4dd1-ad18-04e14f47e21a"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"841854ce-abf8-4e14-b0b4-472ed90b4801"},{"version":"CommandV1","origId":767643462327045,"guid":"34a018f2-0737-4014-a6d9-7573c9f445e0","subtype":"command","commandType":"auto","position":5.0,"command":"df_filtered.groupBy('race_name').sum('points').show()","commandVersion":51,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+--------------------+-----------+\n|           race_name|sum(points)|\n+--------------------+-----------+\n|   Sakhir Grand Prix|      102.0|\n|  Turkish Grand Prix|      102.0|\n|  Spanish Grand Prix|      102.0|\n|Portuguese Grand ...|      102.0|\n|Emilia Romagna Gr...|      102.0|\n|  Italian Grand Prix|      102.0|\n|   Tuscan Grand Prix|      102.0|\n|    Eifel Grand Prix|      102.0|\n|  British Grand Prix|      102.0|\n|  Russian Grand Prix|      102.0|\n| Austrian Grand Prix|      102.0|\n|  Styrian Grand Prix|      102.0|\n|Hungarian Grand Prix|      102.0|\n|  Bahrain Grand Prix|      102.0|\n|Abu Dhabi Grand Prix|      102.0|\n|  Belgian Grand Prix|      102.0|\n|70th Anniversary ...|      102.0|\n+--------------------+-----------+\n\n","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673084553178,"submitTime":1673084553156,"finishTime":1673084553633,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",736]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d821e64f-a144-4b82-93aa-6afbbadc441e"},{"version":"CommandV1","origId":767643462327046,"guid":"335fe6bb-d57f-40f7-b0ec-8cb2e91a1fc4","subtype":"command","commandType":"auto","position":3.5,"command":"from pyspark.sql.functions import countDistinct, count, avg, sum","commandVersion":23,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673084232781,"submitTime":1673084232761,"finishTime":1673084232838,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e4024aef-dc55-4477-b141-439d58380aef"},{"version":"CommandV1","origId":767643462327047,"guid":"cf6e24f6-602d-4f12-9a57-88eb5e33ce3d","subtype":"command","commandType":"auto","position":6.0,"command":"df_filtered.groupBy('driver_name').agg(sum('points'), count('race_name')).sort(df_filtered.driver_name.desc()).show()","commandVersion":47,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+-----------------+-----------+----------------+\n|      driver_name|sum(points)|count(race_name)|\n+-----------------+-----------+----------------+\n|  Valtteri Bottas|      223.0|              17|\n|     Sergio Pérez|      125.0|              15|\n| Sebastian Vettel|       33.0|              17|\n|  Romain Grosjean|        2.0|              15|\n|Pietro Fittipaldi|        0.0|               2|\n|     Pierre Gasly|       75.0|              17|\n|  Nico Hülkenberg|       10.0|               3|\n|  Nicholas Latifi|        0.0|              17|\n|   Max Verstappen|      214.0|              17|\n|   Lewis Hamilton|      347.0|              16|\n|     Lando Norris|       97.0|              17|\n|     Lance Stroll|       75.0|              16|\n|   Kimi Räikkönen|        4.0|              17|\n|  Kevin Magnussen|        1.0|              17|\n|      Jack Aitken|        0.0|               1|\n|   George Russell|        3.0|              17|\n|     Esteban Ocon|       62.0|              17|\n|     Daniil Kvyat|       32.0|              17|\n| Daniel Ricciardo|      119.0|              17|\n|  Charles Leclerc|       98.0|              17|\n+-----------------+-----------+----------------+\nonly showing top 20 rows\n\n","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673084730300,"submitTime":1673084730023,"finishTime":1673084730718,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",1202]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2ec8f293-b0b9-419c-b8f8-0341d797ffe2"},{"version":"CommandV1","origId":767643462327048,"guid":"f8803f7b-aa02-4975-976e-05108f5fa2c4","subtype":"command","commandType":"auto","position":7.0,"command":"df_filtered_w = df.filter('race_year = 2020 or race_year = 2019')","commandVersion":18,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df_filtered_w","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"race_year","nullable":true,"type":"integer"},{"metadata":{},"name":"race_name","nullable":true,"type":"string"},{"metadata":{},"name":"race_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"circuit_location","nullable":true,"type":"string"},{"metadata":{},"name":"driver_name","nullable":true,"type":"string"},{"metadata":{},"name":"driver_number","nullable":true,"type":"integer"},{"metadata":{},"name":"driver_nationality","nullable":true,"type":"string"},{"metadata":{},"name":"team","nullable":true,"type":"string"},{"metadata":{},"name":"grid","nullable":true,"type":"integer"},{"metadata":{},"name":"fastest_lap","nullable":true,"type":"integer"},{"metadata":{},"name":"race_time","nullable":true,"type":"string"},{"metadata":{},"name":"points","nullable":true,"type":"float"},{"metadata":{},"name":"created_dame","nullable":true,"type":"timestamp"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673084872260,"submitTime":1673084871979,"finishTime":1673084872358,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"24b21c25-4f25-4b6b-b59a-909ff86a695a"},{"version":"CommandV1","origId":767643462327049,"guid":"cac559b5-d308-4b86-bd8a-6ac70cc79e5e","subtype":"command","commandType":"auto","position":8.0,"command":"df_filtered_w.count()","commandVersion":3,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[41]: 760","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673084889875,"submitTime":1673084889855,"finishTime":1673084890375,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",12]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"bf25a989-77d4-4131-a36d-11a0ffe5657e"},{"version":"CommandV1","origId":767643462327050,"guid":"c37ff12f-7d4d-4aed-a4ca-bd925b831a3b","subtype":"command","commandType":"auto","position":9.0,"command":"groupedW = df_filtered_w.groupBy('race_year', 'driver_name').agg(sum('points').alias('total_points'), count('race_name').alias('number_of_races'))\n","commandVersion":44,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"groupedW","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"race_year","nullable":true,"type":"integer"},{"metadata":{},"name":"driver_name","nullable":true,"type":"string"},{"metadata":{},"name":"total_points","nullable":true,"type":"double"},{"metadata":{},"name":"number_of_races","nullable":false,"type":"long"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673085325633,"submitTime":1673085325613,"finishTime":1673085325784,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2fa53510-7e4c-430f-8ba3-052f4b6037bf"},{"version":"CommandV1","origId":767643462327051,"guid":"24f6643d-9ca5-4cb1-94e8-ecfb8769d614","subtype":"command","commandType":"auto","position":10.0,"command":"from pyspark.sql.window import Window\nfrom pyspark.sql.functions import desc, rank","commandVersion":26,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673085355884,"submitTime":1673085355864,"finishTime":1673085355913,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2f4084b5-1df3-4f73-94d3-d148ce984755"},{"version":"CommandV1","origId":767643462327052,"guid":"59d96a43-58cc-410c-bc38-fa8301acae9a","subtype":"command","commandType":"auto","position":11.0,"command":"driverRank = Window.partitionBy('race_year').orderBy(desc('total_points'))","commandVersion":15,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673085357253,"submitTime":1673085357232,"finishTime":1673085357314,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ac2a78d3-adba-41e3-bd5f-308f242cfc85"},{"version":"CommandV1","origId":767643462327053,"guid":"3195fd18-c156-42a3-be94-fea622b83a6d","subtype":"command","commandType":"auto","position":12.0,"command":"groupedW.withColumn('rank', rank().over(driverRank)).show(200)","commandVersion":28,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+---------+------------------+------------+---------------+----+\n|race_year|       driver_name|total_points|number_of_races|rank|\n+---------+------------------+------------+---------------+----+\n|     2019|    Lewis Hamilton|       413.0|             21|   1|\n|     2019|   Valtteri Bottas|       326.0|             21|   2|\n|     2019|    Max Verstappen|       278.0|             21|   3|\n|     2019|   Charles Leclerc|       264.0|             21|   4|\n|     2019|  Sebastian Vettel|       240.0|             21|   5|\n|     2019|      Carlos Sainz|        96.0|             21|   6|\n|     2019|      Pierre Gasly|        95.0|             21|   7|\n|     2019|   Alexander Albon|        92.0|             21|   8|\n|     2019|  Daniel Ricciardo|        54.0|             21|   9|\n|     2019|      Sergio Pérez|        52.0|             21|  10|\n|     2019|      Lando Norris|        49.0|             21|  11|\n|     2019|    Kimi Räikkönen|        43.0|             21|  12|\n|     2019|   Nico Hülkenberg|        37.0|             21|  13|\n|     2019|      Daniil Kvyat|        37.0|             21|  13|\n|     2019|      Lance Stroll|        21.0|             21|  15|\n|     2019|   Kevin Magnussen|        20.0|             21|  16|\n|     2019|Antonio Giovinazzi|        14.0|             21|  17|\n|     2019|   Romain Grosjean|         8.0|             21|  18|\n|     2019|     Robert Kubica|         1.0|             21|  19|\n|     2019|    George Russell|         0.0|             21|  20|\n|     2020|    Lewis Hamilton|       347.0|             16|   1|\n|     2020|   Valtteri Bottas|       223.0|             17|   2|\n|     2020|    Max Verstappen|       214.0|             17|   3|\n|     2020|      Sergio Pérez|       125.0|             15|   4|\n|     2020|  Daniel Ricciardo|       119.0|             17|   5|\n|     2020|      Carlos Sainz|       105.0|             17|   6|\n|     2020|   Alexander Albon|       105.0|             17|   6|\n|     2020|   Charles Leclerc|        98.0|             17|   8|\n|     2020|      Lando Norris|        97.0|             17|   9|\n|     2020|      Pierre Gasly|        75.0|             17|  10|\n|     2020|      Lance Stroll|        75.0|             16|  10|\n|     2020|      Esteban Ocon|        62.0|             17|  12|\n|     2020|  Sebastian Vettel|        33.0|             17|  13|\n|     2020|      Daniil Kvyat|        32.0|             17|  14|\n|     2020|   Nico Hülkenberg|        10.0|              3|  15|\n|     2020|Antonio Giovinazzi|         4.0|             17|  16|\n|     2020|    Kimi Räikkönen|         4.0|             17|  16|\n|     2020|    George Russell|         3.0|             17|  18|\n|     2020|   Romain Grosjean|         2.0|             15|  19|\n|     2020|   Kevin Magnussen|         1.0|             17|  20|\n|     2020| Pietro Fittipaldi|         0.0|              2|  21|\n|     2020|       Jack Aitken|         0.0|              1|  21|\n|     2020|   Nicholas Latifi|         0.0|             17|  21|\n+---------+------------------+------------+---------------+----+\n\n","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673085379079,"submitTime":1673085379058,"finishTime":1673085379843,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",3056]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5618532e-b365-4179-8f01-1b1a053dada8"},{"version":"CommandV1","origId":767643462327054,"guid":"e1ef1180-1da1-4289-a88c-9428302270b6","subtype":"command","commandType":"auto","position":13.0,"command":"df.show()","commandVersion":3,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+---------+--------------------+-------------------+----------------+----------------+-------------+------------------+--------+----+-----------+-----------+------+--------------------+\n|race_year|           race_name|          race_date|circuit_location|     driver_name|driver_number|driver_nationality|    team|grid|fastest_lap|  race_time|points|        created_dame|\n+---------+--------------------+-------------------+----------------+----------------+-------------+------------------+--------+----+-----------+-----------+------+--------------------+\n|     2014|Abu Dhabi Grand Prix|2014-11-23 13:00:00|       Abu Dhabi|  Lewis Hamilton|           44|           British|Mercedes|   2|         49|1:39:02.619|  50.0|2023-01-07 09:31:...|\n|     2014|Abu Dhabi Grand Prix|2014-11-23 13:00:00|       Abu Dhabi|    Felipe Massa|           19|         Brazilian|Williams|   4|         47|     +2.576|  36.0|2023-01-07 09:31:...|\n|     2014|Abu Dhabi Grand Prix|2014-11-23 13:00:00|       Abu Dhabi| Valtteri Bottas|           77|           Finnish|Williams|   3|         54|    +28.880|  30.0|2023-01-07 09:31:...|\n|     2020|Emilia Romagna Gr...|2020-11-01 12:10:00|           Imola|  Lewis Hamilton|           44|           British|Mercedes|   2|         63|1:28:32.430|  26.0|2023-01-07 09:31:...|\n|     2019|  British Grand Prix|2019-07-14 13:10:00|     Silverstone|  Lewis Hamilton|           44|           British|Mercedes|   2|         52|1:21:08.452|  26.0|2023-01-07 09:31:...|\n|     2019|  Spanish Grand Prix|2019-05-12 13:10:00|        Montmeló|  Lewis Hamilton|           44|           British|Mercedes|   2|         54|1:35:50.443|  26.0|2023-01-07 09:31:...|\n|     2019|  Russian Grand Prix|2019-09-29 11:10:00|           Sochi|  Lewis Hamilton|           44|           British|Mercedes|   2|         51|1:33:38.992|  26.0|2023-01-07 09:31:...|\n|     2019|   German Grand Prix|2019-07-28 13:10:00|      Hockenheim|  Max Verstappen|           33|             Dutch|Red Bull|   2|         61|1:44:31.275|  26.0|2023-01-07 09:31:...|\n|     2020|   Tuscan Grand Prix|2020-09-13 13:10:00|         Mugello|  Lewis Hamilton|           44|           British|Mercedes|   1|         58|2:19:35.060|  26.0|2023-01-07 09:31:...|\n|     2019|Abu Dhabi Grand Prix|2019-12-01 13:10:00|       Abu Dhabi|  Lewis Hamilton|           44|           British|Mercedes|   1|         53|1:34:05.715|  26.0|2023-01-07 09:31:...|\n|     2020|  Russian Grand Prix|2020-09-27 11:10:00|           Sochi| Valtteri Bottas|           77|           Finnish|Mercedes|   3|         51|1:34:00.364|  26.0|2023-01-07 09:31:...|\n|     2019|Australian Grand ...|2019-03-17 05:10:00|       Melbourne| Valtteri Bottas|           77|           Finnish|Mercedes|   2|         57|1:25:27.325|  26.0|2023-01-07 09:31:...|\n|     2020|Hungarian Grand Prix|2020-07-19 13:10:00|        Budapest|  Lewis Hamilton|           44|           British|Mercedes|   1|         70|1:36:12.473|  26.0|2023-01-07 09:31:...|\n|     2019| Austrian Grand Prix|2019-06-30 13:10:00|       Spielburg|  Max Verstappen|           33|             Dutch|Red Bull|   2|         60|1:22:01.822|  26.0|2023-01-07 09:31:...|\n|     2020|Portuguese Grand ...|2020-10-25 12:10:00|        Portimão|  Lewis Hamilton|           44|           British|Mercedes|   1|         63|1:29:56.828|  26.0|2023-01-07 09:31:...|\n|     2012|Singapore Grand Prix|2012-09-23 12:00:00|      Marina Bay|Sebastian Vettel|            5|            German|Red Bull|   3|         50|2:00:26.144|  25.0|2023-01-07 09:31:...|\n|     2011| Japanese Grand Prix|2011-10-09 06:00:00|          Suzuka|   Jenson Button|           22|           British| McLaren|   2|         52|1:30:53.427|  25.0|2023-01-07 09:31:...|\n|     2012|  Chinese Grand Prix|2012-04-15 07:00:00|        Shanghai|    Nico Rosberg|            6|            German|Mercedes|   1|         40|1:36:26.929|  25.0|2023-01-07 09:31:...|\n|     2011|Malaysian Grand Prix|2011-04-10 08:00:00|    Kuala Lumpur|Sebastian Vettel|            5|            German|Red Bull|   1|         33|1:37:39.832|  25.0|2023-01-07 09:31:...|\n|     2011|  British Grand Prix|2011-07-10 12:00:00|     Silverstone| Fernando Alonso|           14|           Spanish| Ferrari|   3|         41|1:28:41.196|  25.0|2023-01-07 09:31:...|\n+---------+--------------------+-------------------+----------------+----------------+-------------+------------------+--------+----+-----------+-----------+------+--------------------+\nonly showing top 20 rows\n\n","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673085588382,"submitTime":1673085588084,"finishTime":1673085588644,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",4490]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a0ef7da3-92b5-4276-8297-dc868b041cfd"},{"version":"CommandV1","origId":767643462327055,"guid":"3187cd92-d1f6-45c5-90a6-3e6c1e48987b","subtype":"command","commandType":"auto","position":14.0,"command":"","commandVersion":0,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8af9b973-5eab-4711-9866-76775172278b"}],"dashboards":[],"guid":"27bb65af-c80b-47ec-8236-04d6d2454b1f","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE","environmentMetadata":null}