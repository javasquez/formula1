{"version":"NotebookV1","origId":767643462327216,"name":"5_calculated_race_results","language":"python","commands":[{"version":"CommandV1","origId":767643462327217,"guid":"394c3927-5090-4824-8d03-c666e8bd46a2","subtype":"command","commandType":"auto","position":1.0,"command":"%sql\nuse f1_processed","commandVersion":5,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228323426,"submitTime":1673228323349,"finishTime":1673228323488,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"df157e1f-7bd3-47dd-8654-0c68a929e628"},{"version":"CommandV1","origId":767643462327218,"guid":"1fd91484-5fd2-46ea-900c-64dc4fb6d059","subtype":"command","commandType":"auto","position":2.0,"command":"%sql\nselect * from race_results_updated","commandVersion":15,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[2021,"Mercedes",1,1053,"Lewis Hamilton",2,19.0,9],[2021,"Alpine F1 Team",4,1053,"Fernando Alonso",10,1.0,1],[2021,"AlphaTauri",842,1053,"Pierre Gasly",7,6.0,4],[2021,"McLaren",817,1053,"Daniel Ricciardo",6,8.0,5],[2021,"Red Bull",830,1053,"Max Verstappen",1,25.0,10],[2021,"Ferrari",832,1053,"Carlos Sainz",5,10.0,6],[2021,"Alpine F1 Team",839,1053,"Esteban Ocon",9,2.0,2],[2021,"Aston Martin",840,1053,"Lance Stroll",8,4.0,3],[2021,"Ferrari",844,1053,"Charles Leclerc",4,12.0,7],[2021,"McLaren",846,1053,"Lando Norris",3,15.0,8]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"race_year","type":"\"integer\"","metadata":"{}"},{"name":"team_name","type":"\"string\"","metadata":"{}"},{"name":"driver_id","type":"\"integer\"","metadata":"{}"},{"name":"race_id","type":"\"integer\"","metadata":"{}"},{"name":"driver_name","type":"\"string\"","metadata":"{}"},{"name":"position","type":"\"integer\"","metadata":"{}"},{"name":"points","type":"\"float\"","metadata":"{}"},{"name":"calculated_points","type":"\"integer\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"race_year","nullable":true,"type":"integer"},{"metadata":{},"name":"team_name","nullable":true,"type":"string"},{"metadata":{},"name":"driver_id","nullable":true,"type":"integer"},{"metadata":{},"name":"race_id","nullable":true,"type":"integer"},{"metadata":{},"name":"driver_name","nullable":true,"type":"string"},{"metadata":{},"name":"position","nullable":true,"type":"integer"},{"metadata":{},"name":"points","nullable":true,"type":"float"},{"metadata":{},"name":"calculated_points","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228323994,"submitTime":1673228323371,"finishTime":1673228324595,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",10]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"78d40dcb-b492-413d-aed2-d83a2ea22cda"},{"version":"CommandV1","origId":767643462327219,"guid":"a4c19291-7b4d-40f7-aea3-339c10e8c464","subtype":"command","commandType":"auto","position":3.0,"command":"spark.sql(f\"\"\"\n\nMERGE INTO f1_presentation.calculated_results a\nUSING race_results_updated b\non a.driver_id = b.driver_id and a.race_id = b.race_id\nWHEN MATCHED THEN\n  UPDATE set a.position = b.position,\n  a.points = b.points,\n  a.calculated_points = b.points,\n  a.updatedDate =  CURRENT_TIMESTAMP\nWHEN NOT MATCHED THEN\n  insert (race_year, team_name, driver_id, driver_name, race_id, position, points, calculated_points, createdDate) \n  values (race_year, team_name, driver_id, driver_name, race_id, position, points, calculated_points, CURRENT_TIMESTAMP)   \n\"\"\")","commandVersion":266,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[63]: DataFrame[num_affected_rows: bigint, num_updated_rows: bigint, num_deleted_rows: bigint, num_inserted_rows: bigint]","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228324599,"submitTime":1673228323376,"finishTime":1673228327406,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",124]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2a30a59a-3114-4a39-a0a2-9cb55dcb22ff"},{"version":"CommandV1","origId":767643462327221,"guid":"74b21d79-a050-4cb4-ab31-69d54f57dad9","subtype":"command","commandType":"auto","position":5.0,"command":"%sql \nselect count(1) from f1_presentation.calculated_results","commandVersion":13,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[10055]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"count(1)","type":"\"long\"","metadata":"{\"__autoGeneratedAlias\":\"true\"}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{"__autoGeneratedAlias":"true"},"name":"count(1)","nullable":false,"type":"long"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228327410,"submitTime":1673228323381,"finishTime":1673228328208,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8da8d7e1-d0e7-494a-a254-f8f824d0aa4a"},{"version":"CommandV1","origId":3029141207068883,"guid":"9813d1c0-58f7-4cfe-a2e0-69c54b615926","subtype":"command","commandType":"auto","position":1.5,"command":"dbutils.widgets.text('p_file_date', '')\nv_file_date = dbutils.widgets.get('p_file_date')","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{"p_file_date":"2021-04-18"},"addedWidgets":{"p_file_date":{"widgetType":"text","name":"p_file_date","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null,"autoCreated":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228323493,"submitTime":1673228323354,"finishTime":1673228323589,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"11ac960d-40bf-4211-a650-3acdc91a2e98"},{"version":"CommandV1","origId":3029141207068884,"guid":"faca4383-3675-4573-8d1a-1aa4300a0a9f","subtype":"command","commandType":"auto","position":1.75,"command":"spark.sql(f\"\"\"\n\nCREATE TABLE IF NOT EXISTS f1_presentation.calculated_results (    race_year INT,   team_name STRING, driver_id INT,  driver_name STRING,race_id INT,    position INT,   points FLOAT,   calculated_points INT, createdDate TIMESTAMP, updatedDate TIMESTAMP) USING DELTA\n\"\"\")","commandVersion":37,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[60]: DataFrame[]","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228323594,"submitTime":1673228323360,"finishTime":1673228323790,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",20]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0581929a-ede5-447c-bab6-07b015c7d65a"},{"version":"CommandV1","origId":3029141207068885,"guid":"003a6be9-0383-4304-a93b-0ebf7ce636c6","subtype":"command","commandType":"auto","position":1.875,"command":"spark.sql(f\"\"\"\nCREATE OR REPLACE TEMP VIEW race_results_updated\nAS\nSELECT races.race_year,\n       constructors.name AS team_name,\n       drivers.driver_id,\n       results.race_id,\n       drivers.name AS driver_name,\n       results.position,\n       results.points,\n       11 - results.position AS calculated_points\n  FROM f1_processed.results \n  JOIN f1_processed.drivers ON (results.driver_id = drivers.driver_id)\n  JOIN f1_processed.constructors ON (results.constructorId = constructors.constructor_id)\n  JOIN f1_processed.races ON (results.race_id = races.race_id)\n WHERE results.position <= 10\n AND f1_processed.results.file_date = '{v_file_date}'\n\n\"\"\")","commandVersion":17,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[61]: DataFrame[]","name":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1673228323794,"submitTime":1673228323365,"finishTime":1673228323990,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",20]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ff4a8a85-26fe-4e6d-947c-21fa6bdd43ff"},{"version":"CommandV1","origId":3029141207068886,"guid":"fc81a83a-f2e6-432e-9687-3c89dea13bd2","subtype":"command","commandType":"auto","position":6.0,"command":"","commandVersion":0,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"83e8e6ad-299a-43e5-ade7-3924348547b9"}],"dashboards":[],"guid":"05f29f16-1ce9-42c3-a80f-027cf8dab1c8","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"p_file_date":{"nuid":"e0092c36-b5e2-4a10-baa7-63c7c933b1e1","currentValue":"2021-04-18","widgetInfo":{"widgetType":"text","name":"p_file_date","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null,"autoCreated":null}},"typedWidgetInfo":null}},"notebookMetadata":{"pythonIndentUnit":4,"mostRecentlyExecutedCommandWithImplicitDF":{"commandId":767643462327221,"dataframes":["_sqldf"]}},"reposExportFormat":"SOURCE","environmentMetadata":null}